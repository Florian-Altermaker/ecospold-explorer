document.addEventListener("DOMContentLoaded",function(){fetch("api.php?request=get-sources").then(e=>e.json()).then(e=>{if("success"===e.status){let t=document.getElementById("prm-source");e.data.forEach(e=>{let n=document.createElement("option");n.value=e.id,n.textContent=e.name,t.appendChild(n)})}else emptyPage(),console.error("Failed to fetch sources:",e),popToast("Failed to fetch sources")}).catch(e=>{emptyPage(),console.error("Error fetching sources:",e),popToast("Error fetching sources")})}),document.getElementById("prm-source").addEventListener("change",function(e){let t=e.target.value;fetchImpactCategories(t),fetchElementaryFlows(t);let n=document.querySelectorAll(".hidden");n.forEach(e=>{e.style.display="block"})}),document.getElementById("add-activity-keyword").addEventListener("click",function(){let e=document.getElementById("activity-keywords"),t=e.querySelectorAll('div[id^="prm-activity-keyword-"]'),n=t.length+1,o=document.createElement("div");o.id=`prm-activity-keyword-${n}`,o.classList.add("select-text"),o.classList.add("form-input"),o.innerHTML='<select class="select-1 activity-keyword-rule" name="activity-keyword-rule-'+n+'"><option value="match" selected>match</option><option value="begin">begin with</option><option value="end">end with</option></select><input type="text" class="activity-keyword-value" name="activity-keyword-value-'+n+'"><svg class="remove-button" width="30px" height="30px" stroke-width="1.7" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" color="#800080"><path d="M6.75827 17.2426L12.0009 12M17.2435 6.75736L12.0009 12M12.0009 12L6.75827 6.75736M12.0009 12L17.2435 17.2426" stroke="#800080" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"></path></svg>',e.appendChild(o)}),document.getElementById("activity-keywords").addEventListener("click",function(e){if(e.target&&e.target.closest(".remove-button")){let t=e.target.closest(".remove-button").parentElement;t.remove(),updateActivityKeywordsIDs()}}),document.getElementById("add-reference-flow-keyword").addEventListener("click",function(){let e=document.getElementById("reference-flow-keywords"),t=e.querySelectorAll('div[id^="prm-reference-flow-keyword-"]'),n=t.length+1,o=document.createElement("div");o.id=`prm-reference-flow-keyword-${n}`,o.classList.add("select-text"),o.classList.add("form-input"),o.innerHTML='<select class="select-1 reference-flow-keyword-rule" name="reference-flow-keyword-rule-'+n+'"><option value="match" selected>match</option><option value="begin">begin with</option><option value="end">end with</option></select><input type="text" class="reference-flow-keyword-value" name="reference-flow-keyword-value-'+n+'"><svg class="remove-button" width="30px" height="30px" stroke-width="1.7" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" color="#800080"><path d="M6.75827 17.2426L12.0009 12M17.2435 6.75736L12.0009 12M12.0009 12L6.75827 6.75736M12.0009 12L17.2435 17.2426" stroke="#800080" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"></path></svg>',e.appendChild(o)}),document.getElementById("reference-flow-keywords").addEventListener("click",function(e){if(e.target&&e.target.closest(".remove-button")){let t=e.target.closest(".remove-button").parentElement;t.remove(),updateReferenceFlowKeywordsIDs()}}),document.getElementById("add-intermediate-exchange-keyword").addEventListener("click",function(){let e=document.getElementById("intermediate-exchange-keywords"),t=e.querySelectorAll('div[id^="prm-intermediate-exchange-keyword-"]'),n=t.length+1,o=document.createElement("div");o.id=`prm-intermediate-exchange-keyword-${n}`,o.classList.add("select-text"),o.classList.add("form-input"),o.innerHTML='<select class="select-1 intermediate-exchange-keyword-rule" name="intermediate-exchange-keyword-rule-'+n+'"><option value="match" selected>match</option><option value="begin">begin with</option><option value="end">end with</option></select><input type="text" class="intermediate-exchange-keyword-value" name="intermediate-exchange-keyword-value-'+n+'"><svg class="remove-button" width="30px" height="30px" stroke-width="1.7" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" color="#800080"><path d="M6.75827 17.2426L12.0009 12M17.2435 6.75736L12.0009 12M12.0009 12L6.75827 6.75736M12.0009 12L17.2435 17.2426" stroke="#800080" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"></path></svg>',e.appendChild(o)}),document.getElementById("intermediate-exchange-keywords").addEventListener("click",function(e){if(e.target&&e.target.closest(".remove-button")){let t=e.target.closest(".remove-button").parentElement;t.remove(),updateIntermediateExchangeKeywordsIDs()}}),document.getElementById("add-impact-category").addEventListener("click",function(){let e=document.getElementById("impact-categories"),t=e.querySelectorAll('div[id^="prm-impact-category-"]'),n=t.length+1,o=document.createElement("div");o.id=`prm-impact-category-${n}`,o.classList.add("select-select-select"),o.classList.add("form-input"),o.innerHTML='<select class="select-1 impact-category-rule" name="impact-category-rule-'+n+'"><option value="total" selected>total</option><option value="detail">detail</option></select><select class="select-2 impact-category impact-category-package" name="impact-category-package-'+n+'"><option value="0">-</option></select><select class="select-3 indicator impact-category-value" name="impact-category-value-'+n+'"><option value="0">-</option></select><svg class="remove-button" width="30px" height="30px" stroke-width="1.7" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" color="#800080"><path d="M6.75827 17.2426L12.0009 12M17.2435 6.75736L12.0009 12M12.0009 12L6.75827 6.75736M12.0009 12L17.2435 17.2426" stroke="#800080" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"></path></svg>',e.appendChild(o),populateImpactCategories(`prm-impact-category-${n}`)}),document.getElementById("impact-categories").addEventListener("click",function(e){if(e.target&&e.target.closest(".remove-button")){let t=e.target.closest(".remove-button").parentElement;t.remove(),updateImpactCategoriesIDs()}}),document.getElementById("add-elementary-flow").addEventListener("click",function(){let e=document.getElementById("elementary-flows"),t=e.querySelectorAll('div[id^="prm-elementary-flow-"]'),n=t.length+1,o=document.createElement("div");o.id=`prm-elementary-flow-${n}`,o.classList.add("select-text"),o.classList.add("form-input"),o.innerHTML='<select class="select-1 elementary-flow-rule" name="elementary-flow-rule-'+n+'"><option value="total" selected>total</option><option value="detail">detail</option></select><input type="text" class="autocomplete elementary-flow-value" name="elementary-flow-value-'+n+'"><svg class="remove-button" width="30px" height="30px" stroke-width="1.7" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" color="#800080"><path d="M6.75827 17.2426L12.0009 12M17.2435 6.75736L12.0009 12M12.0009 12L6.75827 6.75736M12.0009 12L17.2435 17.2426" stroke="#800080" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"></path></svg>',e.appendChild(o),populateElementaryFlows(`prm-elementary-flow-${n}`)}),document.getElementById("elementary-flows").addEventListener("click",function(e){if(e.target&&e.target.closest(".remove-button")){let t=e.target.closest(".remove-button").parentElement;t.remove(),updateElementaryFlowsIDs()}}),document.addEventListener("change",function(e){if(e.target&&e.target.classList.contains("impact-category")){let t=e.target.closest("[id]");if(t){let n=t.id;populateIndicators(n)}else console.error("Parent element with an ID not found"),popToast("Parent element with an ID not found")}});const parentDiv=document.getElementById("intermediate-exchange-keywords"),intermediateExchangeCheckbox=document.getElementById("output-intermediate-exchanges");function requestExtract(e){let t=Object.keys(e).map(t=>`${encodeURIComponent(t)}=${encodeURIComponent(JSON.stringify(e[t]))}`).join("&"),n=`api.php?request=get-extract&${t}`;fetch(n,{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>{if(!e.ok)throw Error("Network response was not ok");return e.json()}).then(e=>{let t=document.getElementById("dl-go");t.href=e.data.href,document.getElementById("dl-loader").style.display="none",document.getElementById("dl-button").style.display="block",document.getElementById("dl-go").style.display="block"}).catch(e=>{console.error("Error fetching API:",e),popToast("Error fetching API"),document.getElementById("dl-loader").style.display="none",document.getElementById("dl-button").style.display="block",document.getElementById("dl-go").style.display="none"})}parentDiv.addEventListener("input",function(e){let t=e.target;t.matches('#intermediate-exchange-keywords [id^="prm-intermediate-exchange-"] input[type="text"]')&&(t.value.trim().length>0?intermediateExchangeCheckbox.checked=!0:intermediateExchangeCheckbox.checked=!1)}),document.getElementById("dl-button").addEventListener("click",function(){document.getElementById("dl-button").style.display="none",document.getElementById("dl-go").style.display="none",document.getElementById("dl-loader").style.display="block";let e=Array.from(document.querySelectorAll("select")).map(e=>({name:e.name,value:e.value})),t=Array.from(document.querySelectorAll("input")).map(e=>"checkbox"===e.type?{name:e.name,value:e.checked}:"radio"!==e.type||e.checked?{name:e.name,value:e.value}:void 0).filter(e=>void 0!==e);requestExtract({selects:e,inputs:t})});